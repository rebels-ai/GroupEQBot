# Storage
`GroupEQBot` utilises Elasticsearch database to store registered events.

## Indexes
The list of indexes utilized within the system.

#### GroupUsers
Index name pattern: `{botNameVersion}-group-users-{chatID}`

Description: index, declared for each group bot is added, containing list of users and their metadata including validation info.

Schema:
```bash
[
    userID: Long (userID generated by Telegram)
    event: {
        status:
            {
                currnet_status: Text
                change_history_status:  {status: Date}
            },
        metadata:
            {
                change_history_firstname: {firstname: Date, firstname: Date}
                change_history_lastname: {lastname: Date, lastname: Date}
                change_history_username: {username: Date, username: Date}
            },
        validation:
            {
                passed: Boolean  (by default False)
                start_time: Date (by default None)
                end_time: Date   (by default None)
            }
        statistics:
            {
                total_messages_count: Long
            }
    }
    created: Date
]
```

#### GroupEvents
Index name pattern: `{botNameVersion}-group-events-{chatID}`

Description: index, declared for each group where bot is added, containing all message/member events.

Schema:
```
[
    eventID:  (eventID generated with uuid)
    event: {
        userID: Long (userID generated by Telegram)
        message_id: Long | None (presented only in MessageEvents)
        eventTime: Date
        eventType: Text (MemberEvent | MessageEvent)
        content: Text | None (presented only in MessageEvents)
        raw: Object (ExpectedInternalEvent)
    }
    created: Date
]
```

#### BotMetadata
Index name: `{botNameVersion}-bot-metadata`

Description: single index, containing information about bot status per group

Schema:
```
[
    chatID: (chatID generated by Telegram)
    event: {
            user_id_added_bot: Text
            chat_name: Text
            chat_type: Text
            bot_add_time: Date
            bot_status: Text
        }
    created: Date
]
```

#### BotEvents
Index name: `{botNameVersion}-bot-events`

Description: single index for storing validation events for users from groups, where both user and bot are presented 

Schema:
```
[
    chatID: (chatID generated by Telegram)
    event: {
        userID: (userID generated by Telegram)
        userEvent: {
            eventID:  (eventID generated by Database)
            message: {
                messageID: Long (MessageID from Telegram)
                eventTime: Date
                content: Text
                rawEvent: Object (ExpectedInternalEvent)
                }
            }
        }
    created: Date
]
```

#### ChatsNameIDMappings
Index name: `{botNameVersion}-chats-name-id-mappings`

Description: single index, containing chat ids and names

Schema:
```
[
    event: {
            chatID: Long (chatID generated by Telegram)
            chatName: Text
            chatType: Text
        }
    created: Date
]
```


### Storage Connectors
The way storage connector is build is controlled from `GroupEQBot configurations` file with `which_host_to_use` attribute.
```
- For local development use: "localhost" (meaning main application is running on local machine and DB in container)
- For docker development use: "container" (meaning main application is running in container and DB in container)
```
